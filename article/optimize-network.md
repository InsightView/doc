## 优化网络的问题

nagle算法于延迟确认

如果请求频率太大的话, 可以延迟确认, 减少往返的开销. 如果实现不好, 结果就所有请求都会被一致延迟. 

解决: 关tcp_nodelay tcp_quickack

慢启动: tcp能发送的包的量是有限的, 会慢慢增长, 就是一种防止阻塞机制. 

---

webview优化

图片合并 spriting图片合并; 类似于J2ME 不利于频繁过期小图. 

图片 base64

域名分片, 两次dns请求

https格式, 可以更改证书链; 需要从自由证书 到中间证书 - 到根证书等一个一个的确认; 最简单的就是, 买贵的证书;

ios就是设置锚点, 去相信中间证书. 安卓的ecc证书 

IP 直接连接: 多链接+测速, 最稳定, 复合连接(wechat) 服务器压力小; 但是实现困难 

---

https 2.0 的内容

数据分帧; 将header和body分开, 收到之后来组

首部压缩; 已经有的不在乎请求之类的; 类似于增量更新的算法. 

多路复用 类似于io 减少, 以前可能需要js文件合并, 但是现在也没必要; 引入的二进制数据帧的概念, 其中帧对数据进行顺序标识，如下图所示，这样浏览器收到数据之后，就可以按照序列对数据进行合并，而不会出现合并后数据错乱的情况

服务端推送 全双工特性

---

长链接

可优化空间大; 能够显著提升; 提高稳定率

兼容性好

现成的长链接服务

但是需要的编程功底大; 需要熟悉tcp协议和移动网络特性; 需要后端知识; 

---

心跳的意义; 还活着; 防止nat超时(被运营商分配的ip地址段, 就是nat) 如果nat超时需要较长时间

私有协议的设计要点: 常见byte数组的形成
约定 眸子段对应的byte数组中的, 起始点+长度 
头部协议 1 byte版本, 1 设备类型 1 byte 1 网络环境 1 加密开关 4byte数据长度 然后就是内容

---
错误重传, 区分请求超时还是服务器返回的错误吗, 对不需要修改的数据可以重试, 如果不可以修改, 就需要谨慎选择. 